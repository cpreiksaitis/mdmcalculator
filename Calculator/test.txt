<!DOCTYPE html>
<html>
<head>
  <title>Medical Decision Making Calculator</title>
  <style>
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Medical Decision Making Calculator</h1>
  <form id="myForm">
    <label for="presenting_symptom">What was the patient's presenting symptom?</label><br>
    <input type="text" id="presenting_symptom" name="presenting_symptom"><br><br>

    <label for="symptom_type">Was this a new symptom or exacerbation of a chronic symptom?</label><br>
    <select id="symptom_type" name="symptom_type">
      <option value="">-- Select an option --</option>
      <option value="new">New</option>
      <option value="chronic">Chronic</option>
    </select><br><br>

    <div id="life_threatening_div" class="hidden">
      <label for="life_threatening">Are there diagnoses in your differential that could potentially pose a threat to the patient's life or bodily function?</label><br>
      <select id="life_threatening" name="life_threatening">
        <option value="">-- Select an option --</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select><br><br>

      <div id="diagnoses" class="hidden">
        <label for="diagnoses_input">Please list the diagnoses:</label><br>
        <input type="text" id="diagnoses_input" name="diagnoses_input"><br><br>
      </div>
    </div>

    <div id="systemic_symptoms_div" class="hidden">
      <label for="systemic_symptoms_select">Did this patient have more than one system involved, i.e. 'systemic symptoms'? Explain:</label><br>
      <select id="systemic_symptoms_select" name="systemic_symptoms_select">
        <option value="">-- Select an option --</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select><br><br>

      <div id="systemic_symptoms_input_div" class="hidden">
        <label for="systemic_symptoms_input">Please list the symptoms:</label><br>
        <input type="text" id="systemic_symptoms_input" name="systemic_symptoms_input"><br><br>
      </div>
    </div>

    <div id="chronic_symptoms_div" class="hidden">
      <label for="chronic_select">Would this be considered a severe exacerbation, progression, or side effect of treatment?</label><br>
      <select id="chronic_select" name="chronic_select">
        <option value="">-- Select an option --</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select><br><br>

      <div id="justification" class="hidden">
        <label for="justification_input">Justify the reasoning:</label><br>
        <input type="text" id="justification_input" name="justification_input"><br><br>
      </div>
    </div>

    <label>Did you administer any of the following medications via IV, IM, or SQ?</label><br>
    <input type="checkbox" id="medication1" name="medication_controlled" value="Hydromorphone (Dilaudid)">
    <label for="medication1">Hydromorphone (Dilaudid)</label><br>
    <input type="checkbox" id="medication2" name="medication_controlled" value="Morphine">
    <label for="medication2">Morphine</label><br>
    <input type="checkbox" id="medication3" name="medication_controlled" value="Fentanyl">
    <label for="medication3">Fentanyl</label><br>
    <input type="checkbox" id="medication4" name="medication_controlled" value="Midazolam (Versed)">
    <label for="medication4">Midazolam (Versed)</label><br>
    <input type="checkbox" id="medication5" name="medication_controlled" value="Lorazepam (Ativan)">
    <label for="medication5">Lorazepam (Ativan)</label><br>
    <input type="checkbox" id="medication6" name="medication_controlled" value="Diazepam (Valium)">
    <label for="medication6">Diazepam (Valium)</label><br>
    <input type="checkbox" id="medication7" name="medication_controlled" value="Ketamine">
    <label for="medication7">Ketamine</label><br>
    <input type="checkbox" id="medication8" name="medication_controlled" value="Phenobarbital">
    <label for="medication8">Phenobarbital</label><br>
    <input type="checkbox" id="medication9" name="medication_controlled" value="Naloxone (Narcan)">
    <label for="medication9">Naloxone (Narcan)</label><br>
    <input type="checkbox" id="medication10" name="medication_controlled" value="Buprenorphine (Suboxone)">
    <label for="medication10">Buprenorphine (Suboxone)</label><br>
<br>
    <label>Did you administer any of the following medications?</label><br>
    <input type="checkbox" id="medication11" name="medication_monitored" value="Adenosine">
    <label for="medication11">Adenosine</label><br>
    <input type="checkbox" id="medication12" name="medication_monitored" value="Atropine">
    <label for="medication12">Atropine</label><br>
    <input type="checkbox" id="medication13" name="medication_monitored" value="Bicarbonate IV">
    <label for="medication13">Bicarbonate IV</label><br>
    <input type="checkbox" id="medication14" name="medication_monitored" value="Blood Products">
    <label for="medication14">Blood Products</label><br>
    <input type="checkbox" id="medication15" name="medication_monitored" value="D50/Glucagon">
    <label for="medication15">D50/Glucagon</label><br>
    <input type="checkbox" id="medication16" name="medication_monitored" value="Dexmedetomidine">
    <label for="medication16">Dexmedetomidine</label><br>
    <input type="checkbox" id="medication17" name="medication_monitored" value="Digoxin IV">
    <label for="medication17">Digoxin IV</label><br>
    <input type="checkbox" id="medication18" name="medication_monitored" value="Dilantin (phenytoin) IV">
    <label for="medication18">Dilantin (phenytoin) IV</label><br>
    <input type="checkbox" id="medication19" name="medication_monitored" value="Diltiazem IV">
    <label for="medication19">Diltiazem IV</label><br>
    <input type="checkbox" id="medication20" name="medication_monitored" value="Dobutamine">
    <label for="medication20">Dobutamine</label><br>
    <input type="checkbox" id="medication21" name="medication_monitored" value="Dopamine">
    <label for="medication21">Dopamine</label><br>
    <input type="checkbox" id="medication22" name="medication_monitored" value="Droperidol">
    <label for="medication22">Droperidol</label><br>
    <input type="checkbox" id="medication23" name="medication_monitored" value="Epinephrine IV, IM, SQ">
    <label for="medication23">Epinephrine IV, IM, SQ</label><br>
    <input type="checkbox" id="medication24" name="medication_monitored" value="Esmolol">
    <label for="medication24">Esmolol</label><br>
    <input type="checkbox" id="medication25" name="medication_monitored" value="Etomidate">
    <label for="medication25">Etomidate</label><br>
    <input type="checkbox" id="medication26" name="medication_monitored" value="Haldol IV">
    <label for="medication26">Haldol IV</label><br>
    <input type="checkbox" id="medication27" name="medication_monitored" value="Heparin">
    <label for="medication27">Heparin</label><br>
    <input type="checkbox" id="medication28" name="medication_monitored" value="Hydralazine IV">
    <label for="medication28">Hydralazine IV</label><br>
    <input type="checkbox" id="medication29" name="medication_monitored" value="Insulin IV drip">
    <label for="medication29">Insulin IV drip</label><br>
    <input type="checkbox" id="medication30" name="medication_monitored" value="Ketamine">
    <label for="medication30">Ketamine</label><br>
    <input type="checkbox" id="medication31" name="medication_monitored" value="Labetalol IV">
    <label for="medication31">Labetalol IV</label><br>
    <input type="checkbox" id="medication32" name="medication_monitored" value="Lidocaine IV">
    <label for="medication32">Lidocaine IV</label><br>
    <input type="checkbox" id="medication33" name="medication_monitored" value="Magnesium IV">
    <label for="medication33">Magnesium IV</label><br>
    <input type="checkbox" id="medication34" name="medication_monitored" value="Metoprolol IV">
    <label for="medication34">Metoprolol IV</label><br>
    <input type="checkbox" id="medication35" name="medication_monitored" value="Nicardipine IV">
    <label for="medication35">Nicardipine IV</label><br>
    <input type="checkbox" id="medication36" name="medication_monitored" value="Nitroglycerin IV">
    <label for="medication36">Nitroglycerin IV</label><br>
    <input type="checkbox" id="medication37" name="medication_monitored" value="Norepinephrine">
    <label for="medication37">Norepinephrine</label><br>
    <input type="checkbox" id="medication38" name="medication_monitored" value="Phenylephrine">
    <label for="medication38">Phenylephrine</label><br>
    <input type="checkbox" id="medication39" name="medication_monitored" value="Potassium IV">
    <label for="medication39">Potassium IV</label><br>
    <input type="checkbox" id="medication40" name="medication_monitored" value="Procainamide">
    <label for="medication40">Procainamide</label><br>
    <input type="checkbox" id="medication41" name="medication_monitored" value="Rocuronium">
    <label for="medication41">Rocuronium</label><br>
    <input type="checkbox" id="medication42" name="medication_monitored" value="Propofol">
    <label for="medication42">Propofol</label><br>
    <input type="checkbox" id="medication43" name="medication_monitored" value="Succinylcholine">
    <label for="medication43">Succinylcholine</label><br>
    <input type="checkbox" id="medication44" name="medication_monitored" value="Thrombolytics">
    <label for="medication44">Thrombolytics</label><br>
    <input type="checkbox" id="medication45" name="medication_monitored" value="Vasopressin">
    <label for="medication45">Vasopressin</label><br>
    <input type="checkbox" id="medication46" name="medication_monitored" value="Versed">
    <label for="medication46">Versed</label><br>
    <input type="checkbox" id="medication47" name="medication_monitored" value="Verapamil IV">
    <label for="medication47">Verapamil IV</label><br>
    <input type="checkbox" id="medication48" name="medication_monitored" value="3% Normal Saline">
    <label for="medication48">3% Normal Saline</label><br><br>

  
    <label>Did you administer or prescribe any other prescription drugs? Which ones? </label> <br>
    <textarea id="otherDrugs" name="otherDrugs" rows="4" cols="50"></textarea><br><br>

    <input type="checkbox" id="ivFluids" name="ivFluids" value="yes">
    <label for="ivFluids">Were IV fluids administered?</label><br><br>

    <input type="checkbox" id="sedatingMeds" name="sedatingMeds" value="yes">
    <label for="sedatingMeds">Were any potentially sedating medications administered?</label><br><br>

    <input type="checkbox" id="anticoagulation" name="anticoagulation" value="yes">
    <label for="anticoagulation">Was anticoagulation initiated?</label><br><br>

    <input type="checkbox" id="sitter" name="sitter" value="yes">
    <label for="sitter">Did this patient require a sitter or physical restraints?</label><br><br>

    <input type="checkbox" id="ivPlaced" name="ivPlaced" value="yes">
    <label for="ivPlaced">Did the patient have an IV placed?</label><br><br>

    <label>Did you perform any major procedures?</label><br>
    <input type="checkbox" id="major_procedure1" name="major_procedure" value="Management of a Displaced Fracture">
    <label for="major_procedure1">Management of a Displaced Fracture</label><br>
    <input type="checkbox" id="major_procedure2" name="major_procedure" value="Reduction of a shoulder, TMJ, wrist, elbow, or ankle">
    <label for="major_procedure2">Reduction of a shoulder, TMJ, wrist, elbow, or ankle</label><br>
    <input type="checkbox" id="major_procedure3" name="major_procedure" value="Insertion of a chest tube">
    <label for="major_procedure3">Insertion of a chest tube</label><br>
    <input type="checkbox" id="major_procedure4" name="major_procedure" value="Cardioversion of the patient">
    <label for="major_procedure4">Cardioversion of the patient</label><br>
    <input type="checkbox" id="major_procedure5" name="major_procedure" value="Endotracheal Intubation">
    <label for="major_procedure5">Endotracheal Intubation</label><br>
    <input type="checkbox" id="major_procedure6" name="major_procedure" value="Lumbar puncture">
    <label for="major_procedure6">Lumbar puncture</label><br>
    <input type="checkbox" id="major_procedure7" name="major_procedure" value="Thoracentesis">
    <label for="major_procedure7">Thoracentesis</label><br>
    <input type="checkbox" id="major_procedure8" name="major_procedure" value="Paracentesis">
    <label for="major_procedure8">Paracentesis</label><br>
    <input type="checkbox" id="major_procedure9" name="major_procedure" value="Placement of an IO">
    <label for="major_procedure9">Placement of an IO</label><br>
    <input type="checkbox" id="major_procedure10" name="major_procedure" value="Placement of a central line">
    <label for="major_procedure10">Placement of a central line</label><br>
    <input type="checkbox" id="major_procedure11" name="major_procedure" value="Placement of an arterial line">
    <label for="major_procedure11">Placement of an arterial line</label><br>
    <input type="checkbox" id="major_procedure12" name="major_procedure" value="Procedural sedation">
    <label for="major_procedure12">Procedural sedation</label><br><br>

    <input type="checkbox" id="surgery" name="surgery" value="yes">
    <label for="surgery">Was this patient admitted for surgery?</label><br><br>


    <label>Did you perform any minor procedures?</label><br>
    <input type="checkbox" id="minor_procedure1" name="minor_procedure" value="Laceration repair">
    <label for="minor_procedure1">Laceration repair</label><br>
    <input type="checkbox" id="minor_procedure2" name="minor_procedure" value="Incision and drainage">
    <label for="minor_procedure2">Incision and drainage</label><br>
    <input type="checkbox" id="minor_procedure3" name="minor_procedure" value="Foreign body removal">
    <label for="minor_procedure3">Foreign body removal</label><br>
    <input type="checkbox" id="minor_procedure4" name="minor_procedure" value="Nerve block">
    <label for="minor_procedure4">Nerve block</label><br><br>

    <label>Is there a reason this minor procedure is higher risk? Explain why:</label><br> 
    <textarea id="minorProcedureRisk" name="minorProcedureRisk" rows="4" cols="50"></textarea><br><br>

    <label>List what external records, if any you reviewed and what they provided:</label><br>
    <textarea id="externalRecords" name="externalRecords" rows="4" cols="50"></textarea><br><br>

    <label>List anyone you talked to who provided history the patient couldn't provide. What did they provide?</label><br>
    <textarea id="independent_historian" name="independent_historian" rows="4" cols="50"></textarea><br><br>

    <label>What tests did you order?</label><br>
    <input type="checkbox" id="test1" name="test" value="ECG">
    <label for="test1">ECG</label><br>
    <input type="checkbox" id="test2" name="test" value="CBC">
    <label for="test2">CBC</label><br>
    <input type="checkbox" id="test3" name="test" value="CMP">
    <label for="test3">CMP</label><br>
    <input type="checkbox" id="test4" name="test" value="Lipase">
    <label for="test4">Lipase</label><br>
    <input type="checkbox" id="test5" name="test" value="Troponin">
    <label for="test5">Troponin</label><br>
    <input type="checkbox" id="test6" name="test" value="Urinalysis">
    <label for="test6">Urinalysis</label><br>
    <input type="checkbox" id="test7" name="test" value="Pregnancy Test">
    <label for="test7">Pregnancy Test</label><br>
    <input type="checkbox" id="test8" name="test" value="Type and screen">
    <label for="test8">Type and screen</label><br>
    <input type="checkbox" id="test9" name="test" value="PT/PTT">
    <label for="test9">PT/PTT</label><br>
    <input type="checkbox" id="test10" name="test" value="BNP">
    <label for="test10">BNP</label><br>
    <input type="checkbox" id="test11" name="test" value="CT scan with IV contrast">
    <label for="test11">CT scan with IV contrast</label><br>
    <input type="checkbox" id="test12" name="test" value="CT scan without IV contrast">
    <label for="test12">CT scan without IV contrast</label><br>
    <input type="checkbox" id="test13" name="test" value="Chest X ray">
    <label for="test13">Chest X ray</label><br>
    <input type="checkbox" id="test14" name="test" value="Abdominal X ray">
    <label for="test14">Abdominal X ray</label><br>
    <input type="checkbox" id="test15" name="test" value="Extremity X ray">
    <label for="test15">Extremity X ray</label><br>
    <input type="checkbox" id="test16" name="test" value="Formal ultrasound">
    <label for="test16">Formal ultrasound</label><br>
    <label for="test17">Other:</label>
    <input type="text" id="test17" name="test"><br><br>
    

    <label>List independant interpretation of a test (X-ray, EKG, Ultrasound, Rhythm Strip) NOT Labs</label><br>
    <textarea id="independent_interpretation" name="independent_interpretation" rows="4" cols="50"></textarea><br><br>

    <label>List any external physicians (consultants or radiology) or other appropriate source talked to (CM, SW, facility)</label><br>
    <textarea id="consultants" name="consultants" rows="4" cols="50"></textarea><br><br>

    <label>Was diagnosis or treatment significantly impacted by social determinants of health?</label><br>
    <textarea id="social_determinants" name="social_determinants" rows="4" cols="50"></textarea><br><br>

    <label>Did you *consider* hospitalization or escalation of care for this patient? Why?</label><br>
    <textarea id="hospitalization" name="hospitalization" rows="4" cols="50"></textarea><br><br>

    <label>Did you decide not to recusitate or escalate care because of poor prognosis? Why?</label><br>
    <textarea id="poor_prognosis" name="poor_prognosis" rows="4" cols="50"></textarea><br><br>
    
    <h2>Results:</h2>
    <div>
      <label for="problem_complexity">Problem Complexity:</label>
      <span id="problem_complexity"></span>
    </div>
    
    <div>
      <label for="risk">Risk:</label>
      <span id="risk"></span>
    </div>
    
    <div>
      <label for="data">Data:</label>
      <span id="data"></span>
    </div>

    <div>
      <label for="mdm">Medical Decision Making:</label>
      <span id="mdm"></span>
    </div>

    <div>
      <label for="text_output">Text Output:</label>
    <span id="text_output"></span>
    </div>
  </form>
 
  <script>
    document.getElementById("symptom_type").addEventListener("change", toggleSymptomType);
    document.getElementById("life_threatening").addEventListener("change", toggleDiagnosisInput);
    document.getElementById("life_threatening").addEventListener("change", toggleSystemicSymptomsInput);
    document.getElementById("systemic_symptoms_select").addEventListener("change", toggleSystemicSymptomsDataInput);
    document.getElementById("chronic_select").addEventListener("change", toggleJustificationInput);

    function toggleSymptomType() {
        var symptomType = document.getElementById("symptom_type").value;
        var lifeThreateningDiv = document.getElementById("life_threatening_div");
        var chronicSymptomsDiv = document.getElementById("chronic_symptoms_div");
        var systemicSymptomsDiv = document.getElementById("systemic_symptoms_div");

        lifeThreateningDiv.classList.toggle("hidden", symptomType !== "new");
        chronicSymptomsDiv.classList.toggle("hidden", symptomType !== "chronic");
        systemicSymptomsDiv.classList.add("hidden");
    }

    function toggleDiagnosisInput() {
        var lifeThreatening = document.getElementById("life_threatening").value;
        var diagnosesDiv = document.getElementById("diagnoses");

        diagnosesDiv.classList.toggle("hidden", lifeThreatening !== "yes");
    }

    function toggleSystemicSymptomsInput() {
        var lifeThreatening = document.getElementById("life_threatening").value;
        var systemicSymptomsDiv = document.getElementById("systemic_symptoms_div");

        systemicSymptomsDiv.classList.toggle("hidden", lifeThreatening !== "no");

    }

    function toggleSystemicSymptomsDataInput() {
        var systemicSymptomsSelect = document.getElementById("systemic_symptoms_select").value;
        var systemicSymptomsInputDiv = document.getElementById("systemic_symptoms_input_div");

        systemicSymptomsInputDiv.classList.toggle("hidden", systemicSymptomsSelect !== "yes");
    }


    function toggleJustificationInput() {
        var chronicSelect = document.getElementById("chronic_select").value;
        var justificationDiv = document.getElementById("justification");

        justificationDiv.classList.toggle("hidden", chronicSelect !== "yes");
    }

    
    window.onload = function() {
    var form = document.getElementById("myForm");

    form.addEventListener("input", function (event) {
        event.preventDefault();
        
        var formData = new FormData(form);
        var output = generateOutput(formData);
        displayOutput(output, formData);
    });
};

    

    function generateOutput(formData) {
        var problemComplexity = "";
        var risk = "";
        var data = "";

        var symptomType = formData.get("symptom_type");
        var lifeThreatening = formData.get("life_threatening");
        var chronicSelect = formData.get("chronic_select");
        

        if ((symptomType === "new" && lifeThreatening === "yes") || (symptomType === "chronic" && chronicSelect === "yes")) {
            problemComplexity = "5";
        } else {
            problemComplexity = "4";
        }

        var majorProcedureValues = [
          formData.get("major_procedure1"),
          formData.get("major_procedure2"),
          formData.get("major_procedure3"),
          formData.get("major_procedure4"),
          formData.get("major_procedure5"),
          formData.get("major_procedure6"),
          formData.get("major_procedure7"),
          formData.get("major_procedure8"),
          formData.get("major_procedure9"),
          formData.get("major_procedure10"),
          formData.get("major_procedure11"),
          formData.get("major_procedure12"),
        ]

        var medicationValues = [
          formData.get("medication1"),
          formData.get("medication2"),
          formData.get("medication3"),
          formData.get("medication4"),
          formData.get("medication5"),
          formData.get("medication6"),
          formData.get("medication7"),
          formData.get("medication8"),
          formData.get("medication9"),
          formData.get("medication10"),
          formData.get("medication11"),
          formData.get("medication12"),
          formData.get("medication13"),
          formData.get("medication14"),
          formData.get("medication15"),
          formData.get("medication16"),
          formData.get("medication17"),
          formData.get("medication18"),
          formData.get("medication19"),
          formData.get("medication20"),
          formData.get("medication21"),
          formData.get("medication22"),
          formData.get("medication23"),
          formData.get("medication24"),
          formData.get("medication25"),
          formData.get("medication26"),
          formData.get("medication27"),
          formData.get("medication28"),
          formData.get("medication29"),
          formData.get("medication30"),
          formData.get("medication31"),
          formData.get("medication32"),
          formData.get("medication33"),
          formData.get("medication34"),
          formData.get("medication35"),
          formData.get("medication36"),
          formData.get("medication37"),
          formData.get("medication38"),
          formData.get("medication39"),
          formData.get("medication40"),
          formData.get("medication41"),
          formData.get("medication42"),
          formData.get("medication43"),
          formData.get("medication44"),
          formData.get("medication45"),
          formData.get("medication46"),
          formData.get("medication47"),
          formData.get("medication48"),
        ]

        var HighRiskFactors = [
            formData.get("test11"),
            formData.get("hospitalization"),
            formData.get("surgery"),
            formData.get("poor_prognosis"),
            ...majorProcedureValues,
            formData.get("sitter"),
            formData.get("anticoagulation"),
            formData.get("sedatingMeds"),
            ...medicationValues,
        ];

        var ModRiskFactors = [
            formData.get("test12"),
            formData.get("test13"),
            formData.get("test14"),
            formData.get("ivPlaced"),
            formData.get("ivFluids"),
            formData.get("social_determinants"),
            formData.get("otherDrugs"),
        ];

        if (HighRiskFactors.length > 0) {
            risk = "5";
        } else if (ModRiskFactors.length > 0) {
            risk = "4";
        } else {
            risk = "3";
        }

  

var externalRecords = formData.get("externalRecords");
var independent_historian = formData.get("independent_historian");
var testValues = formData.getAll("test");
var independent_interpretation = formData.get("independent_interpretation");
var consultants = formData.get("consultants");

var testValues = [
    formData.get("test1"),
    formData.get("test2"),
    formData.get("test3"),
    formData.get("test4"),
    formData.get("test5"),
    formData.get("test6"),
    formData.get("test7"),
    formData.get("test8"),
    formData.get("test9"),
    formData.get("test10"),
    formData.get("test11"),
    formData.get("test12"),
    formData.get("test13"),
    formData.get("test14"),
    formData.get("test15"),
    formData.get("test16"),
];

// Filter out null values
var checkedTestValues = testValues.filter(test => test !== null);

var test17 = formData.get("test17");

// Calculate the counts
var HighComplexityCount = checkedTestValues.length
    + (externalRecords && externalRecords.trim().length > 0 ? 1 : 0)
    + (independent_historian && independent_historian.trim().length > 0 ? 1 : 0)
    + (test17 && test17.trim().length > 0 ? 1 : 0);

var LowComplexityCount = checkedTestValues.length
    + (externalRecords && externalRecords.trim().length > 0 ? 1 : 0)
    + (test17 && test17.trim().length > 0 ? 1 : 0);




if ((HighComplexityCount > 2) && ((independent_interpretation && independent_interpretation.trim().length > 0) || (consultants && consultants.trim().length > 0))) {
    data = "5";
} else if ((HighComplexityCount > 2) || ((independent_interpretation && independent_interpretation.trim().length > 0) || (consultants && consultants.trim().length > 0))) {
    data = "4";
} else if ((LowComplexityCount > 1) || (independent_historian && independent_historian.trim().length > 0)) {
    data = "3";
} else {
    data = "2";
}


        var output = {
            problemComplexity: problemComplexity,
            risk: risk,
            data: data,
        };

        var mdm = calculateMedian([problemComplexity, risk, data]);
output.mdm = mdm;

// Update the MDM value in the HTML
var mdmElement = document.getElementById("mdm");
mdmElement.textContent = mdm;


return output;
    }
function calculateMedian(values) {
    // Sort the values in ascending order
    var sortedValues = values.sort(function (a, b) {
        return a - b;
    });

    var length = sortedValues.length;
    var mid = Math.floor(length / 2);

    // Check if the number of values is even or odd
    if (length % 2 === 0) {
        // For even number of values, calculate the average of the middle two values
        return (sortedValues[mid - 1] + sortedValues[mid]) / 2;
    } else {
        // For odd number of values, return the middle value
        return sortedValues[mid];
    }
}

function generateTextOutput(formData, risk, data, mdm) {
    var symptomType = formData.get("symptom_type");
    var lifeThreatening = formData.get("life_threatening");
    var chronicSelect = formData.get("chronic_select");
    var presenting_symptom = formData.get("presenting_symptom");
    var diagnoses_input = formData.get("diagnoses_input");
    var systemic_symptoms_select = formData.get("systemic_symptoms_select");
    var systemic_symptoms_input = formData.get("systemic_symptoms_input");
    var justification_input = formData.get("justification_input");
    var medications_controlled = formData.getAll("medication_controlled");
    var medications_montiored = formData.getAll("medication_monitored");
    var otherDrugs = formData.get("otherDrugs");
    var ivFluids = formData.get("ivFluids");
    var sedatingMeds = formData.get("sedatingMeds");
    var anticoagulation = formData.get("anticoagulation");
    var sitter = formData.get("sitter");
    var ivPlaced = formData.get("ivPlaced");
    var major_procedures = formData.getAll("major_procedure");
    var surgery = formData.get("surgery");
    var minor_procedures = formData.getAll("minor_procedure");
    var minorProcedureRisk = formData.get("minorProcedureRisk");
    var externalRecords = formData.get("externalRecords");
    var independent_historian = formData.get("independent_historian");
    var tests = formData.getAll("test");
    var independent_interpretation = formData.get("independent_interpretation");
    var consultants = formData.get("consultants");
    var social_determinants = formData.get("social_determinants");
    var hospitalization = formData.get("hospitalization");
    var poor_prognosis = formData.get("poor_prognosis");
    var problem_complexity = formData.get("problem_complexity");
    var ctContrast = document.querySelector("#test11");
    var ctNonCon = document.querySelector("#test12");
    var chestXR = document.querySelector("#test13");
    var abdXR = document.querySelector("#test14");


var textOutput = "";
textOutput += `This patient presented with ${presenting_symptom}, `;

    if (symptomType === "new") {
        if (lifeThreatening === "yes") {
            textOutput += `which represented a potential threat to the patient's life or major bodily function due to consideration of the following diagnoses: ${diagnoses_input}. `;
        } else if (systemic_symptoms_select === "yes") {
            textOutput += `which represented an acute illness with systemic symptoms due to the presence of the following: ${systemic_symptoms_input}. `;
        } else {
            textOutput += `which represented an undiagnosed new problem with an uncertain outcome due to the broad potential differential that had to be considered. `;
        }
    } 
    else if (symptomType === "chronic") {
        if (chronicSelect === "yes") {
            textOutput += `which represented a severe exacerbation of a chronic illness due to the following factors: ${justification_input}. `;
        } else {
            textOutput += `which represented exacerbation of a chronic illness. `;
        }
    }
textOutput += `Caring for this patient required a number of care decisions that place the patient at `;   
    if (risk === "3") {
        textOutput += ` low risk `;
    } else if (risk === "4") {
        textOutput += ` moderate risk `;
    } else if (risk === "5") {
        textOutput += ` high risk `;
    }


textOutput += `of morbidity, mortality, or complications. These decisions included: `;
    if (medications_controlled.length > 0) {
        textOutput += `The administration of the following parenteral controlled substances: ${medications_controlled.join(", ")}. `;
    }
    if (medications_montiored.length > 0) {
        textOutput += `Administration of the following drug therapies requiring intensive monitoring for toxicity: ${medications_montiored.join(", ")}. `;
    }
    if (otherDrugs.length > 0) {
        textOutput += `Administration or prescription of the following prescription drugs: ${otherDrugs}. `;
    }
    if (ivFluids === "yes") {
        textOutput += `Ordering intravenous fluids for this patient, which carry the risk of causing life-threatening complications such as pulmonary edema from volume overload, rapid and dangerous changes in electrolytes, or medication errors. `;
    }
    if (sedatingMeds === "yes") {
        textOutput += `Administration of a sedating medication which may impact the patient's ability to breathe properly, may lead to a drop in blood pressure, anaphylactic reactions, paradoxical reactions and other complications, any of which could be life-threatening. `;
    }
    if (anticoagulation === "yes") {
        textOutput += `Initiation of an anticoagulant medication, which increases the risk of bleeding and other life-threatening side effects, additionally these medications often must be adjusted based on the patient's renal function and potential for drug-drug interaction. `;
    }
    if (sitter === "yes") {
        textOutput += `The use of physical restraints or monitoring by security personnel, which placed them at risk of physical or psychological trauma and increased the risk of further behavioral decompensation. `;
    }
    if (ivPlaced === "yes") {
        textOutput += `Obtaining intravenous access for this patient, which has a number of moderate risks including damage to surrounding structures, introduction of infection, and pain or reaction at the insertion site. `;
    }
    if (major_procedures.length > 0) {
        textOutput += `Performance of the following major emergent procedure(s): ${major_procedures.join(", ")}. `;
    }
    if (surgery === "yes") {
        textOutput += `The need for major emergent surgery. `;
    }
    if (minor_procedures.length > 0) {
        textOutput += `Performance of the following minor procedures: ${minor_procedures.join(", ")}`;
    }
    if (minorProcedureRisk.length > 0) {
        textOutput += `, which was considered high risk due to: ${minorProcedureRisk}. `;
    }
    if (ctContrast.checked) {
        textOutput += `To perform a CT scan with IV contrast, which carries the risk of exposure to ionizing ratiation and the potential for a severe and life threatening allergic reaction, anaphylaxisis. `;
    }
    if (ctNonCon.checked) {
        textOutput += `To perform a CT scan, which exposes the patient to ionizing radiation and can increase the risk of development of malignancy with repeated exposure `;
    }
    if (chestXR.checked) {
        textOutput += `To undergo a chest x ray, which exposes the patient to a nontrivial amount of radiation and carries a moderate risk of potential morbidity. `;
    }
    if (abdXR.checked) {
        textOutput += `To undergo an abdominal x ray, which exposes the patient to a nontrivial amount of radiation and carries a moderate risk of potential morbidity. `;
    }
    if (hospitalization.length > 0) {
        textOutput += `Considering hospitalization or escalation of care for this patient for the following reasons: ${hospitalization}. `;
    }
    if (social_determinants.length > 0) {
        textOutput += `The patient's diagnosis and/or treatment was significantly impacted social determinants of heath in the following ways: ${social_determinants}. `;
    }
    if (poor_prognosis.length > 0) {
        textOutput += `Deciding not to resuscitate or to de-escalate care for this patient based on their poor prognosis for the following reasons: ${poor_prognosis}. `;
    }

textOutput += `Additionally, caring for this patient required a`;
if (data === "3") {
        textOutput += ` low complexity of data to be reviewed and analyzed including: `;
    } else if (data === "4") {
        textOutput += ` moderate complexity of data to be reviewed and analyzed including: `;
    } else if (risk === "5") {
        textOutput += ` high complexity of data to be reviewed and analyzed including: `;
    } else if (data === "2"){
        textOutput += ` straightforward complexity of data to be reviewed and analyzed including: `;
    }
if (externalRecords.length > 0) {
        textOutput += `Review of the following external records: ${externalRecords}. `;
    }
if (independent_historian.length > 0) {
        textOutput += `Completing a part of this patient's assessment with data from an independent historian: ${independent_historian}. `;
    }
if (tests.length > 0) {
        textOutput += `Ordering the following unique tests: ${tests.join(", ")}. `;
    }
if (independent_interpretation.length > 0) {
        textOutput += `Performing an independent interpretation of the following test, which aided in the patient's care: ${independent_interpretation}. `;
    }
if (consultants.length > 0) {
        textOutput += `Engaging in a direct, interactive discussion regarding the management of this patient or test interpretation with the following: ${consultants}. `;
    }
if (mdm==="3"){
        textOutput += `Therefore caring for this patient required a low complexity of medical decision making. `;
    } else if (mdm==="4"){
        textOutput += `Therefore caring for this patient required a moderate complexity of medical decision making. `;
    } else if (mdm==="5"){
        textOutput += `Therefore caring for this patient required a high complexity of medical decision making. `;
    }
    return textOutput;
}



    function displayOutput(output, formData) {
        var problemComplexityElement = document.getElementById("problem_complexity");
        var riskElement = document.getElementById("risk");
        var dataElement = document.getElementById("data");
        var textOutput = generateTextOutput(formData, output.risk, output.data, output.mdm);
        var textOutputElement = document.getElementById("text_output");

        textOutputElement.textContent = textOutput;
        problemComplexityElement.textContent = output.problemComplexity;
        riskElement.textContent = output.risk;
        dataElement.textContent = output.data;
    }
</script>


</body>
</html>

